@using Crimenuts.App.Web.Models
@using Crimenuts.Utils.Localization
@functions{
    //  >> App_Code | Localization 
    // Now: Localization | App_Code
    
    // ===================================================================================== []
    // Data
    private static void InitLocalizator()
    {
        Localizator.SetTranslation("Menu:Home", Lang.Ru, "Домой");
        Localizator.SetTranslation("Menu:Home", Lang.En, "Home");

        Localizator.SetTranslation("Menu:Cases", Lang.Ru, "Дела");
        Localizator.SetTranslation("Menu:Cases", Lang.En, "Cases");

        Localizator.SetTranslation("Menu:Processes", Lang.Ru, "Процессы");
        Localizator.SetTranslation("Menu:Processes", Lang.En, "Processes");
    }

    // ===================================================================================== []
    // Tools
    private static bool _needInit = true;
    private static void InitLocalizatorIfNeed()
    {
        if (!_needInit) return;
        InitLocalizator();
        _needInit = false;
    }

    public static string Text(string key)
    {
        InitLocalizatorIfNeed();

        return Localizator.GetTranslation(key, CurrentLanguage);
    }

    private static Lang GetCookieLang()
    {
        var langInCookie = Request.Cookies[SiteModel.LangCookieName];
        if (langInCookie != null)
        {
            try
            {
                return (Lang)int.Parse(langInCookie.Value);
            }
            catch
            {
                return Lang.En;
            }
        }
        return Lang.En;
    }

    public static Lang CurrentLanguage
    {
        get { return GetCookieLang(); }
    }
}
